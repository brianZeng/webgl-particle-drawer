!function(){function a(b){var c,d=eb.readyFuncs;if(x(b))c=function(){M(b)};else{if(!w(b))throw Error("argument should be an animation option or a function");c=b}d?f(eb.readyFuncs,c):c(a)}function b(a,b){var c={};return a=a||{},t(b||{},function(b,d){c[d]=a.hasOwnProperty(d)?a[d]:b}),c}function c(a,b){return t(b,u,a),a}function d(a,b,c,d){w(b)&&(b=new b),b=b||{};var e,f=a.prototype=Object.create(b);if(c)for(var g in c)e=Object.getOwnPropertyDescriptor(c,g),e?Object.defineProperty(f,g,e):f[g]=c[g];return d&&o.forEach(d,function(a,b){Object.defineProperty(f,a,b)}),a}function e(a){if(!(this instanceof e))return new e(a);if(a&&a.length)for(var b=0,c=a.length;c>b;b++)this[b]=a[b]}function f(a,b){var c=a.indexOf(b);return-1==c?!!a.push(b):!1}function g(a,b,c){var d=j(b);return a.sort(c?function(a,b){return d(a)<d(b)}:function(a,b){return d(a)>d(b)})}function h(a,b){for(var c,d=0,e=a.length,f=j(b);e>d;d++)if(f(c=a[d]))return c;return void 0}function i(a,b){var c=a.indexOf(b);return c>=0?!!a.splice(c,1):!1}function j(a){return y(a)?function(b){return b[a]}:w(a)?a:function(a){return a}}function k(a){return w(a)?a:a&&y(a)?function(b){return b?b[a]:void 0}:function(a){return a}}function l(a,b,c,d,e){var f,g,h=k(b);if(void 0===c&&(c=!0),d){for(f=0,g=a[0];g;g=a[++f])if(h(g)==c)return e?f:g}else for(f=0,g=a[0];g;g=a[++f])if(h(g)===c)return e?f:g;return void 0}function m(a,b,c,d){var e=a.slice();return void 0===d&&(d=a),e.forEach(b,d),a.filter(c,d)}function n(a,b,c){return a.hasOwnProperty(b)?f(a[b],c):a[b]=[c],a}function o(a){return this instanceof o?void("object"==typeof a&&t(a,function(b,c){var d;(d=Object.getOwnPropertyDescriptor(a,c))?Object.defineProperty(this,c,d):this[c]=b},this)):new o(a)}function p(a,b,c){return y(b)&&b&&w(c)&&(a.hasOwnProperty(kb)||(a[kb]={}),n(a[kb],b,c)),a}function q(a,b,c,d){function e(a){-1==a.apply(d,c)&&h.push(a)}var f,g,h;return a.hasOwnProperty(kb)&&(g=(f=a[kb])[b])?(c?c instanceof Array||(c=[c]):c=[],void 0===d&&(d=a),h=[],(f[b]=m(g,e,function(a){return-1==h.indexOf(a)})).length):!1}function r(a,b,c){var d,f;return void 0===b?delete a[kb]:(d=a[kb])&&(f=d[b])&&f&&(c?e.remove(f,c):delete d[b]),a}function s(a,b,c){return w(c)&&a.on(b,function(){return c.apply(a,arguments),-1}),a}function t(a,b,c,d){if(x(a))if(void 0==c&&(c=a),a instanceof Array)a.forEach(b,c);else for(var e=0,f=Object.getOwnPropertyNames(a),g=f[0];g;g=f[++e])b.apply(c,[a[g],g,d]);return a}function u(a,b){this[b]=a}function v(){for(var a={},b=0,c=arguments.length;c>b;b++)t(arguments[b],u,a);return a}function w(a){return"function"==typeof a}function x(a){return"object"==typeof a&&a}function y(a){return"string"==typeof a}function z(){}function A(a){for(var b,c,d=0,e={};(b=a.indexOf("{",d))>-1;)c=a.indexOf("}",b),n(e,a.substring(d,b).trim(),B(a.substring(b+1,c))),d=c+1;return e}function B(a,b){var c,d=x(b)?b:{};return a.split(";").forEach(function(a){(a=a.replace(/[\r\n\t\f\s]/g,""))&&(c=a.split(":"),d[c[0]]=c[1])}),d}function C(a){return this instanceof C?(this.$merge(a),void(this.$invalid=!0)):new C(a)}function D(a){return a?a[0].toUpperCase()+a.substring(1):""}function E(a,b){return x(a)&&(b=a.rules.join(";"),a=a.selector),a+"{"+b+"}"}function F(){}function G(a){return this instanceof G?(this.name=a,this.timeline=new pa(this),this._updateObjs=[],this._finalizeObjs=[],void(this._global=null)):new G(a)}function H(a){return this instanceof H?(c(this,b(a,{selector:"",fillMode:lb.REMOVE,clock:a.clock||new R(a)})),this._cssHandlerMap={},this._matHandlerMap={},this._cachedMat={},this._immutable={},this._variable={},this._param={},this.current={},this.use(a),void this.init()):new H(a)}function I(a,b){var c,d;if(!(c=a._task)){if(b=b||{},c=b.task||(d=b.global||eb.global).getTask(b.taskName||a._ltName)||d.defaultTask,!(c instanceof G))throw Error("please specify the render task for animation to restart");c.add(a)}return c}function J(a,b,c,d){var e=a.clock;return e&&(e[b](),c&&a.emit(c,d)),a}function K(a){return eb.Promise(function(b,c){function d(){b(a)}a.once(ob,function(a){a&&a.global?a.global.once(hb,d):d()}).once(pb,function(){c(a)})})}function L(a,b){var c,d;return b=b||{},t(a,function(e,f){(c=Object.getOwnPropertyDescriptor(a,f))&&"function"==typeof(d=c.get)?Object.defineProperty(b,f,{get:d}):b[f]=e}),b}function M(b){if(!x(b))throw Error("cannot construct an animation");var c=a.register[b.animationName];return c||(c=H),N(b,new c(b))}function N(a,b){return(a.renderGlobal||eb.global).getTask(a.taskName,!0).add(b),a.autoStart!==!1&&b.start(),b}function O(a){for(var b,c=1,d=arguments[1];d;d=arguments[++c])sb.forEach(function(c){w(b=d[c])?a[c](b):x(b)&&(Q(b)?t(b,function(b,d){a[c](d,b)}):a[c](b))}),a.param(d.param).param(d.variable).param(d.immutable,!0);return a}function P(a){var b,c={},d=a[0];if(void 0!=d&&void 0!=(b=a[1]))c[d]=b;else if(w(b=a[0])||!Q(b))c["&"]=b;else{if(!x(b))throw Error("argument Error");c=b}return c}function Q(a){return x(a)&&Object.getOwnPropertyNames(a).some(function(b){var c=typeof a[b];return"object"==c||"function"==c})}function R(a){return this instanceof R?void c(this,b(a,{duration:1,ease:R.EASE.linear,infinite:!1,iteration:1,silent:!1,autoReverse:!1,delay:0,hold:0})).reset():new R(a)}function S(a,b,c){var d=a.controller;a.emit(b,c),d&&w(d.emit)&&d.emit(b,c)}function T(a,b){function c(){return a.i>1||a.infinite?(a.i--,U(a,f),S(a,ub,b),void 0):(a.i=0,a._holdTime=f,a._status=Db,S(a,yb,b),T(a,b)||!0)}var d,e=b.timeline,f=e.now;switch(a._status){case Gb:return a._initTime=f,S(a,tb,b),a._status=Cb,T(a,b)||!0;case Cb:return f>=a._initTime+a.delay*e.ticksPerSecond?(a._status=Bb,a._activeTime=a._startTime=f,S(a,wb,b),T(a,b)||!0):!1;case Bb:var g=(f-a._activeTime)/e.ticksPerSecond,h=a.d?g/a.duration:1-g/a.duration;return d=a.t,d===h?!1:(h>1?a.t=1:0>h?a.t=0:a.t=h,a.value=a.ease(a.t),S(a,gb,b),a.silent||b.task.invalid(),(h>1||0>h)&&(a._status=Fb,T(a,b)),!0);case Fb:if(d=a.t,!(d>=1)){if(a.autoReverse)return c(a.d=1);throw Error("impossible state t=0,autoReverse=false")}return a.autoReverse?(a.d=0,U(a,f),S(a,vb,b),!1):c();case Db:return f>=a._holdTime+a.hold*e.ticksPerSecond?(a._status=Eb,a._endTime=f,a.emit(ob,b),a.finalize(b.task),!0):!1}}function U(a,b){a._status=Bb,a._activeTime=b}function V(a,b){if(a){b.clock=a;var c=T(a,b);b.clock=null}return c}function W(a){var c=x(a)?a.tagName:a,d=b(a,{attributes:{}}),e=document.createElement(c);return t(d.attributes,function(a,b){e.setAttribute(b,a)}),e}function X(a,b,c,d,e,f){if(!(this instanceof X))return new X(a,b,c,d,e,f);var g;g=void 0==a?[1,0,0,0,1,0,0,0,1]:void 0==b?a:[a,b,0,d,e,c,f,1],this.elements=new Float32Array(g)}function Y(a,b){var c=+a;return isNaN(c)?b:c}function Z(a,b,c){var d=b,e=a.elements,f=e;c?(e=b,d=f=a.elements):(d=b,e=f=a.elements);var g=d[0],h=d[1],i=d[2],j=d[3],k=d[4],l=d[5],m=d[6],n=d[7],o=d[8],p=e[0],q=e[1],r=e[2],s=e[3],t=e[4],u=e[5],v=e[6],w=e[7],x=e[8];return f[0]=g*p+h*s+i*v,f[1]=g*q+h*t+i*w,f[2]=g*r+h*u+i*x,f[3]=j*p+k*s+l*v,f[4]=j*q+k*t+l*w,f[5]=j*r+k*u+l*x,f[6]=m*p+n*s+o*v,f[7]=m*q+n*t+o*w,f[8]=m*r+n*u+o*x,a}function $(a){var b=a.createRenderState();a.emit(fb,[b]),_(a,b),ca(a,b),a.emit(hb,[b])}function _(a,b){b.global.emit(gb,[b,a]),t(a._tasks,function(a){aa(a,b)})}function aa(a,b){function c(a,c){x(a)?a.disabled||(w(a.update)?a.update(b):w(a.emit)&&a.emit(gb,b)):d[c]=void 0}if(!a.disabled){var d=a._updateObjs;b.task=a,(b.timeline=a.timeline).move(),a.update(b),a.emit(gb,b),a._updateObjs=m(d,c,x),b.task=null}}function ba(a){for(var b=a.sheet,c=b.cssRules.length;c>0;c--)b.deleteRule(c-1);return a}function ca(a,b){function c(a,b,c){b&&a&&d.insertRule(E(a,b),c)}if(a._invalid||b.forceRender){t(a._tasks,function(a){da(a,b)});var d=ba(a._styleElement).sheet;b.styleStack.forEach(function(a,b){c(a.selector,a.rules.join(";"),b)});var e=new C,f=d.cssRules.length;t(b.transformMap,function(a,b){b&&(e.$withPrefix("transform",a+""),c(b,e.$toSafeCssString(),f++))}),a._invalid=!1}t(a._tasks,function(a){ea(a,b)}),a._forceRender=!1}function da(a,b){a.disabled||(b.task=a,(a._invalid||b.forceRender)&&(a.emit(ib,b),a._updateObjs.forEach(function(a){w(a.render)&&!a.disabled&&a.render(b)}),a._invalid=!1),a.emit(jb,b),b.task=null)}function ea(a,b){var c,d=(b.task=a)._updateObjs,e=a._finalizeObjs;a._finalizeObjs=[],e.length&&(a.invalid(),e.forEach(function(e){-1!=(c=d.indexOf(e))&&(d[c]=null),e._task==a&&(e._task=null),x(e)&&w(e.finalize)&&e.finalize(b)}))}function fa(a,b){var c=a.clock;return b.animation=a,V(c,b)&&(a.invalid(),ia(a),a.emit(gb,b)),c.finished&&(a._finished=!0,ga(a,b)),b.animatetion=null,!0}function ga(a){var b=a.fillMode;a.fillMode!==lb.KEEP&&(a.finalize(),b===lb.SNAPSHOT&&(a.cancelStyle=eb.global.immediate(a.lastStyleText())))}function ha(a,b){var c=b.styleStack;b.animation=a,c.push.apply(c,ja(a)),ka(a,b.transformMap),a.emit(nb,b),a._finished&&a.emit(ob,b),b.animation=null}function ia(a){var b=a.percent,c=a.current=Object.create(a._immutable);t(a._variable,function(a,d){c[d]=w(a)?a(b,c):isNaN(a)?a:b*a})}function ja(a,b){var c=a.current,d=[],e=a.selector;return t(a._cssHandlerMap,function(f,g){var h=g.replace(/&/g,e),i=[];f.forEach(function(d){var e=ma(d.cb,d.proxy,a,c,b).$toCachedCssString();e&&i.push(e)}),h&&i.length&&d.push({selector:h,rules:i})}),d}function ka(a,b){var c=a.selector,d=a.current;t(a._matHandlerMap,function(e,f){var g=f.replace(/&/g,c),h=la(b,g);e.forEach(function(b){if(h=b.call(a,h,d)||h,!(h instanceof X))throw Error("Transform function should return an instance of Flip.Mat3")}),g&&(b[g]=h)})}function la(a,b){var c=a[b];return c||(c=new X,b&&(a[b]=c)),c}function ma(a,b,c,d,e){return e||(x(a)?b.$merge(a):w(a)?a.apply(c||b,[b,d]):y(a)&&B(a,b)),b}function na(a){return this instanceof na?(a=b(a,{defaultTaskName:"default"}),this._tasks={},this._defaultTaskName=a.defaultTaskName,this._invalid=!0,this._persistIndies=[],this._persistElement=W({tagName:"style",attributes:{"data-flip":"persist"}}),void(this._styleElement=W({tagName:"style",attributes:{"data-flip":"frame"}}))):new na(a)}function oa(b,c,d,e){function f(){return g?(h=null,g()):void 0}var g,h={_cssHandlerMap:{},_matHandlerMap:{},selector:y(d)?d:""};return H.prototype[c].apply(h,[d,e]),a(function(){var a;if("css"==c)a=ja(h).map(E);else{if("transform"!=c)throw Error("invalid property:"+c);var d={};a=[],ka(h,d),t(d,function(b,c){var d=new C;d.$withPrefix("transform",b+""),a.push(d.$styleText(c))})}g=b.immediate.apply(b,a)}),f}function pa(a){this.last=this.now=this._stopTime=0,this._startTime=this._lastStop=Date.now(),this.task=a,this._isStop=!0}function qa(a){return this instanceof qa?(a=a||{},this.binder={},this._children=[],this._disabled=!1,this._parent=null,void this.addBinder(a.binder)):new qa(a)}function ra(a){return this instanceof ra?(this.name=a.name||Mb(this.constructor.name||"GLBinder"),w(a.bind)&&(this.bind=a.bind),void this.invalid()):new ra(a)}function sa(a){return this instanceof sa?(this.name=a.name,void(this.value=a.value)):new sa(a)}function ta(a,b,c){this._loc=b,this.name=c,this.type=a}function ua(a,b){var c;if(a instanceof Ta)c=a.elements;else if(a instanceof Array)return new Ta(a.slice(0,b));if(a.subarray)return new Ta(c.subarray(0,b));throw Error("cannot convert to vec"+b)}function va(a,b){var c;if(a instanceof Float32Array)c=new Float32Array(a);else{if(!(a instanceof Array)){if(a.elements)return va(a.elements,b);throw Error("not support")}c=new Float32Array(b);for(var d=0;b>d;d++)c[d]=a[d]}return{elements:c}}function wa(a,b,c,d){this.name=a,this._stride=c||0,this._offset=d||0,this.buffer=b,this._invalid=!0}function xa(a,b,c){var d;switch(a){case"vec2":d=2;break;case"vec3":d=3;break;case"vec4":d=4;break;case"float":d=1}this._size=d,this._loc=b,this.name=c}function ya(a,b,c){this._type="number"==typeof b?b:b?WebGLRenderingContext.ELEMENT_ARRAY_BUFFER:WebGLRenderingContext.ARRAY_BUFFER,a&&(this.data=a),this._refs=[],this._glHandle=null,this.usage=c||WebGLRenderingContext.STATIC_DRAW,this._buffered=!1}function za(a){return this instanceof za?(a=a||{},ra.call(this,{name:a.name||"camera"}),this.viewMatrixUniformName=a.viewMatrixUniformName,this.projectionMatrixUniformName=a.projectionMatrixUniformName,this.viewProjectionMatrixUniformName=a.viewProjectionMatrixUniformName,this.config(a),a.viewPosition instanceof Array&&this.setPosition.apply(this,a.viewPosition),void(a.viewPerspective instanceof Array&&this.setPerspective.apply(this,a.viewPerspective))):new za(a)}function Aa(a){return a=a||{},this instanceof Aa?(ra.call(this,{name:a.name}),this._w=a.width||0,this._h=a.height||0,this._depthBuffer=a.useDepthBuffer?new Fa:null,this._texture=new Sa(!1),this._index=null,this._fbo=null,this._buffered=!1,void(this.textureParam=b(a.textureParam,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:"CLAMP_TO_EDGE",TEXTURE_WRAP_T:"CLAMP_TO_EDGE"}))):new Aa(a)}function Ba(a){return this instanceof Ba?(qa.call(this,a),this.drawMode=isNaN(a.drawMode)?WebGLRenderingContext.TRIANGLES:a.drawMode,a.indexBuffer?this.indexBuffer=a.indexBuffer:this.setDrawRange(a.drawCount,a.startIndex),void this.invalid()):new Ba(a)}function Ca(a){var b=this._indexBuffer;b&&b.length&&(b.bind(a),a.drawElements(this.drawMode,b.length,a.UNSIGNED_SHORT,0))}function Da(a){this.drawCount&&a.drawArrays(this.drawMode,this.startIndex,this.drawCount)}function Ea(a){return this instanceof Ea?(this._maxActiveTexureNum=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS)-1,this._maxCubeTextureNum=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),this._max2DTextureNum=a.getParameter(a.MAX_TEXTURE_SIZE),this._maxFrameBufferNum=a.getParameter(a.MAX_RENDERBUFFER_SIZE),this._maxRenderBufferNum=a.getParameter(a.MAX_RENDERBUFFER_SIZE),this._maxBufferNum=2048,this._texture2DS=[],this._textureCubes=[],this._buffers=[],this._renderBuffers=[],this._frameBuffers=[],this._indexUsage=new Uint8Array(this._maxActiveTexureNum),this._bindingTexture=this._bindingBuffer=this._bindingFrameBuffer=null,void(this._activeIndex=void 0)):new Ea(a)}function Fa(){this._glObj=null}function Ga(a){return this instanceof Ga?(G.call(this,a.name,a),void this.init(a)):new Ga(a)}function Ha(a){return this instanceof Ha?(this.name=a.name,this.flipY=a.flipY!==!1,this.source=a.source,this.texture=new Sa,void(this.param=b(a.param,{TEXTURE_MAG_FILTER:"LINEAR",TEXTURE_MIN_FILTER:"LINEAR",TEXTURE_WRAP_S:a.warpRepeat?"REPEAT":"CLAMP_TO_EDGE",TEXTURE_WRAP_T:a.warpRepeat?"REPEAT":"CLAMP_TO_EDGE"}))):new Ha(a)}function Ia(a){return a instanceof HTMLImageElement||a instanceof Image}function Ja(a){return a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement}function Ka(a,b){var c;if(Ia(b)){if(!b.complete)throw Error("image should be loaded before use");c=WebGLRenderingContext.RGB}else if(Ja(b))c=WebGLRenderingContext.RGBA;else if(x(b)&&+b.width&&+b.height&&b.data instanceof Uint8Array)c=b.format||WebGLRenderingContext.RGBA;else{if(b)throw Error("invalid source");c=0}a._source=b,a.format=c}function La(a){return this instanceof La?void 0:new La(a)}function Ma(a){return this instanceof Ma?(qa.call(this,a),this.vertexSource=a.vertexSource,this.fragSource=a.fragSource,void(this._glVars=Ra(this.vertexSource+this.fragSource))):new Ma(a)}function Na(a,b){var c,d,e,f;(c=a.program)||(c=a.program=Oa(b,d=a.vertexSource,e=a.fragSource),f=Pa(b,c,d+e),a.glParam=v(a.attributes=f.attributes,a.uniforms=f.uniforms))}function Oa(a,b,c){var d,e=a.createProgram(),f=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(f,c),a.compileShader(f);var g=a.getShaderParameter(f,a.COMPILE_STATUS);return g||(d=a.getShaderInfoLog(f),console.log("fshader Failed to compile shader: "+d)),a.attachShader(e,f),a.deleteShader(f),f=a.createShader(a.VERTEX_SHADER),a.shaderSource(f,b),a.compileShader(f),g=a.getShaderParameter(f,a.COMPILE_STATUS),g||(d=a.getShaderInfoLog(f),console.log("vshader Failed to compile shader: "+d)),a.attachShader(e,f),a.linkProgram(e),a.deleteShader(f),e}function Pa(a,b,c){var d=Ra(c),e={},f={};return t(d.attributes,function(c,d){var f=a.getAttribLocation(b,d);if(-1==f)throw Error("Fail to get attribute "+d);e[d]=new xa(c.type,f,d)}),t(d.uniforms,function(c,d){if(!f.hasOwnProperty(d)){var e=a.getUniformLocation(b,d);if(-1==e)throw Error("Fail to get uniform "+d);f[d]=new ta(c.type,e,d)}}),{uniforms:f,attributes:e}}function Qa(a,b){var c=a.uniforms,d=a.attributes,e={};return t(b,function(a,b){var f;c.hasOwnProperty(b)?(f=c[b],e[b]=Nb[f.type](f.name,a)):d.hasOwnProperty(b)?e[b]=new wa(b,a):e[b]=a}),e}function Ra(a){for(var b,c={},d={},e=/\b(uniform|attribute)\s+(vec[234]|int|float|sampler2D|samplerCube|mat[234])\s+\b(\w+)\b\s?;/gm;b=e.exec(a);){var f="uniform"===b[1]?c:d,g=b[3];f[g]={name:g,type:b[2]}}return{uniforms:c,attributes:d}}function Sa(a){this._index=-1,this._type=a?WebGLRenderingContext.TEXTURE_CUBE_MAP:WebGLRenderingContext.TEXTURE_2D}function Ta(a){return a instanceof Ta?a.clone():void(this.elements=new Float32Array(a))}function Ua(a){if(!(this instanceof Ua))return new Ua(a);var b;b=a instanceof Array?new Float32Array(a):a instanceof Ua?new Float32Array(a.elements):a&&a.buffer instanceof ArrayBuffer?new Float32Array(a):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.elements=b}function Va(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b[0],p=b[1],q=b[2],r=d[0],s=d[1],t=d[2],u=c[0],v=c[1],w=c[2];return Math.abs(o-u)<Pb&&Math.abs(p-v)<Pb&&Math.abs(q-w)<Pb?([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1].forEach(function(b,c){a[c]=b}),a):(k=o-u,l=p-v,m=q-w,n=1/Math.sqrt(k*k+l*l+m*m),k*=n,l*=n,m*=n,e=s*m-t*l,f=t*k-r*m,g=r*l-s*k,n=Math.sqrt(e*e+f*f+g*g),n?(n=1/n,e*=n,f*=n,g*=n):(e=0,f=0,g=0),h=l*g-m*f,i=m*e-k*g,j=k*f-l*e,n=Math.sqrt(h*h+i*i+j*j),n?(n=1/n,h*=n,i*=n,j*=n):(h=0,i=0,j=0),a[0]=e,a[1]=h,a[2]=k,a[3]=0,a[4]=f,a[5]=i,a[6]=l,a[7]=0,a[8]=g,a[9]=j,a[10]=m,a[11]=0,a[12]=-(e*o+f*p+g*q),a[13]=-(h*o+i*p+j*q),a[14]=-(k*o+l*p+m*q),a[15]=1,a)}function Wa(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a}function Xa(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d[0],D=d[1],E=d[2],F=Math.sqrt(C*C+D*D+E*E);return Math.abs(F)<Pb?null:(F=1/F,C*=F,D*=F,E*=F,e=Math.sin(c),f=Math.cos(c),g=1-f,h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],p=b[8],q=b[9],r=b[10],s=b[11],t=C*C*g+f,u=D*C*g+E*e,v=E*C*g-D*e,w=C*D*g-E*e,x=D*D*g+f,y=E*D*g+C*e,z=C*E*g+D*e,A=D*E*g-C*e,B=E*E*g+f,a[0]=h*t+l*u+p*v,a[1]=i*t+m*u+q*v,a[2]=j*t+n*u+r*v,a[3]=k*t+o*u+s*v,a[4]=h*w+l*x+p*y,a[5]=i*w+m*x+q*y,a[6]=j*w+n*x+r*y,a[7]=k*w+o*x+s*y,a[8]=h*z+l*A+p*B,a[9]=i*z+m*A+q*B,a[10]=j*z+n*A+r*B,a[11]=k*z+o*A+s*B,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)}function Ya(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function Za(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a}function $a(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a}function _a(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a}function ab(a,b){var c=b.gl;b.glSecne;t(a,function(a){w(a)?a(c,b):w(a.bind)&&a.bind(c,b)})}function bb(a,b){var c=b.glSecne,d=c.attributes,e=c.uniforms,f=a.binder;a._invalidBinder&&(t(f,function(b,c){var g;if(d.hasOwnProperty(c)&&!(f[c]instanceof wa)||e.hasOwnProperty(c)&&!(f[c]instanceof sa))g=f[c]=(d[c]||e[c]).convert(b);else if(w(b))g=f[c]=new ra({name:c,bind:b});else{if(!(b instanceof ra))return;g=b}g._controller=a}),a._invalidBinder=!1)}function cb(a,b,c){function d(b,c){if(y(b)&&(w(c)||c instanceof ra))a[b]=c;else{if(!x(b)||!b.name)throw Error("argument error");a[b.name]=b}}return!x(b)||b instanceof ra?(w(b)&&!c&&(c=b,b="GLBinder"+Mb("GLBinder")),d(b,c)):t(b,function(a,b){d(b,a)}),a}function db(a,b){t(a,function(a){x(a)&&w(a.dispose)&&a.dispose(b)})}var eb={readyFuncs:[],global:null};Object.defineProperty(a,"instance",{get:function(){return eb.global}}),a.fallback=function(b){b.requestAnimationFrame||(b.requestAnimationFrame=function(a){setTimeout(a,30)},a.Mat3.prototype.applyContext2D=function(a){var b=this.elements;a.transform(b[0],b[1],b[2],b[3],b[4],b[5])}),b.Float32Array||(b.Float32Array=d(function a(b){if(!(this instanceof a))return new a(b);var c,d,e=0;for("number"==typeof b?(c=[0],d=b):d=(c=b).length,e;d>e;e++)this[e]=c[e]||0},Array.prototype))},a.css=function(b,c){return a.instance.css(b,c)},a.parseCssText=B,a.parseStyleText=A,a.transform=function(b,c){return a.instance.transform(b,c)};var fb="frameStart",gb="update",hb="frameEnd",ib="renderStart",jb="renderEnd";"undefined"!=typeof module&&module.exports?module.exports=a:window&&(window.Flip=a),a.util={Object:o,Array:e,inherit:d};var kb="_callbacks";e.remove=i,e.add=f,e.first=h,e.findBy=l,e.sort=g,d(e,Array,{add:function(a){return f(this,a)},findBy:function(a,b,c){return l(this,a,b,c)},remove:function(a){return i(this,a)},first:function(a){return h(this,a)}}),o.on=p,o.emit=q,o.off=r,o.once=s,o.forEach=t,d(o,null,{on:function(a,b){return p(this,a,b)},emit:function(a,b,c){return q(this,a,b,c)},off:function(a,b){return r(this,a,b)},once:function(a,b){return s(this,a,b)},forEach:function(a,b,c){return t(this,a,b,c)}}),a.CssProxy=C,function(){function b(a){return isNaN(a)?a:Number(a).toFixed(5).replace(/\.0+$/,"")}function c(a){var c,d=arguments;return a.replace(/\$\{(\d+)}/g,function(a,e){return void 0==(c=d[e])?a:b(c)})}function d(a){return a.replace(/^\-/,"").replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()})}function e(a){var b=typeof a;return"string"==b||"number"==b?a:void 0}function f(a){var b=/^(webkit|moz|o|ms)[A-Z]/.test(a)?"-":"";return b+a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}function g(a,b,c){b.forEach(function(b){Object.defineProperty(a,b,c)})}var h,i,j="$$",k=[];i=w(window.CSS2Properties)?Object.getOwnPropertyNames(CSS2Properties.prototype).filter(function(a){return-1==a.indexOf("-")}):Object.getOwnPropertyNames(document.documentElement.style);var l=C.prototype={$styleText:function(a,b){return E(a,this.$toSafeCssString(b))},$toCachedCssString:function(a){return this.$invalid&&(this.$cachedCssString=this.$toSafeCssString(),this.$invalid=!!a),this.$cachedCssString},$toSafeCssString:function(a){var c=[];return t(this,function(a,d){var e=k.indexOf(d);e>-1&&void 0!==a&&c.push(i[e]+":"+b(a))}),c.join(";"+(a||""))},toString:function(){return this.$toSafeCssString()},$withPrefix:function(a,b,c){var e=this;return(c||h).forEach(function(c){e[d(c+a)]=b}),e},$merge:function(a){return x(a)&&a!==this&&t(a,u,this),this},$template:c};i=i.map(function(a){function b(){return this[d]}function c(a){var b=e(a);b!=this[d]&&(this.$invalid=!0,this[d]=b)}var d=j+a,h=D(a),i=a[0].toLowerCase()+a.substring(1),m=f(a);return k.push(d),g(l,[a,m,h,i],{get:b,set:c}),m}),h=["-moz-","-ms-","-webkit-","-o-",""].filter(function(a){var b=a.replace(/^\-/,"");return i.some(function(c){return 0==c.indexOf(b)||0==c.indexOf(a)})}),a.stringTemplate=l.$t=c}(),d(a.Render=F,a.util.Object,{update:function(){},render:function(){},finalize:function(){},invalid:function(){var a,b;(a=this._task)?a.invalid():(b=this.parent)&&b.invalid(),this._invalid=!0}}),a.RenderTask=G,d(G,a.util.Object,{update:z,invalid:function(){var a;this._invalid=!0,(a=this._global)&&a.invalid()},toFinalize:function(a){return this._updateObjs.indexOf(a)>-1&&f(this._finalizeObjs,a)},add:function(a,b){if(a._task)throw Error("_task has been taken");return"update"==b?f(this._updateObjs,a):((a instanceof R||a instanceof F)&&f(this._updateObjs,a)&&(a._task=this),void this.invalid())},remove:function(a){(a._task==this||this._updateObjs.indexOf(a)>-1)&&(a._task=null,this.toFinalize(a),this.invalid())}});var lb=H.FILL_MODE={REMOVE:"remove",SNAPSHOT:"snapshot",KEEP:"keep"};d(H,F,{get percent(){return this.clock.value||0},set clock(a){var b=this._clock;if(a=a||null,b!=a){if(b&&a)throw Error("remove the animation clock before add a new one");this._clock=a,a?a.controller=this:b&&(b.controller=null)}},get clock(){return this._clock},get promise(){return this._promise||(this._promise=K(this))},get finished(){return this._finished},get id(){return this._id||(this._id=Mb("Animation"+this.type)),this._id},get elements(){return a.$(this.selector)},init:function(){this._promise=null,this._canceled=this._finished=!1,this.invalid()},reset:function(a){var b;return(b=this.clock)&&b.reset(1),a||this.init(),this},use:function(a){return O(this,a),this},param:function(a,b,c){return x(a)?L(a,this[b?"_immutable":"_variable"]):y(a)&&(this[c?"_immutable":"_variable"][a]=b),this},transform:function(a,b){var c=this._matHandlerMap;return t(P(arguments),function(a,b){var d;if(a instanceof X)d=function(b){return b.concat(a)};else{if(!w(a))throw Error("callback expect function or mat");d=function(b,c){return a.apply(this,[b,c])||b}}n(c,b,d)}),this},css:function(a,b){var c=this._cssHandlerMap;return t(P(arguments),function(a,b){n(c,b,{cb:a,proxy:new C})}),this},update:function(a){fa(this,a)},render:function(a){ha(this,a)},invalid:function(){this._task&&this._task.invalid()},finalize:function(){var a;return(a=this._task)?(this._ltName=a.name,a.toFinalize(this)):this._canceled||(this.reset(1),this.emit(mb)),this},start:function(){return I(this),this._canceled?this.restart():J(this,"start")},resume:function(a){return J(this,"resume",rb,a)},pause:function(a){return J(this,"pause",qb,a)},cancel:function(a){var b;return this._canceled||this._finished||((b=this._task)&&(this._ltName=b.name),this._canceled=!0,this.emit(pb,a),this.finalize()),this},restart:function(a){return I(this,a),this.clock.reset(),this.init(),this.start()},then:function(a,b){return this.promise.then(a,b)},lastStyleText:function(a){return ja(this,!0).map(E).join(a)}});var mb="finalize",nb="render",ob="finish",pb="cancel",qb="pause",rb="resume";a.animate=M,a.register=function(){function a(c){var e,f,g=c.name;return e=c.beforeCallBase||b,f=function(a){if(!(this instanceof f))return new f(a);var b=L(a,L(c,{}));e.call(this,b,a),H.call(this,b),(c.afterInit||z).call(this,b,a)},g&&(a[g]=f),d(f,H.prototype,{type:g,use:function(a){return O(this,c,a)}}),f}function b(a,b){return a}return a}();var sb=["transform","css","on","once"];a.Animation=H,a.Clock=R;var tb="init",ub="iterate",vb="reverse",wb="start",xb="controllerChange",yb="hold",zb=0,Ab=1,Bb=2,Cb=3,Db=4,Eb=5,Fb=6,Gb=7,Hb=8;d(R,o,{get controller(){return this._controller||null},set controller(a){var b=this.controller;a=a||null,b!==a&&(this._controller=a,this.emit(xb,{before:b,after:a,clock:this}))},get started(){return-1!==this._startTime},get finished(){return this._status==Eb},get paused(){return this._status==Ab},get ease(){return this._tf},set ease(a){var b;(w(b=a)||(b=R.EASE[a]))&&(this._tf=b)},start:function(){return this._status==zb&&(this._status=Gb),!1},restart:function(){return this.reset().start()},reset:function(){return this._status=zb,this.d=1,this.i=this.iteration,this._endTime=this._initTime=this._activeTime=this._startTime=this._holdTime=this._pausedTime=0,this},pause:function(){this._status!==Ab&&(this._lastStatus=this._status,this._status=Ab,S(this,qb))},resume:function(){this._status==Ab&&(this._status=this._lastStatus,S(this,rb))},cancel:function(){this._status!==Hb&&(this._status=Hb,this.finalize(),this.controller&&this.controller.cancel(),this.emit(pb))},finalize:function(){var a=this._task;a instanceof G?a.toFinalize(this):this.emit(mb)},update:function(a){this.finished?this.finalize():V(this,a)}}),a.EASE=R.EASE=function(){var a={linear:function(a){return a},zeroStep:function(a){return 0>=a?0:1},halfStep:function(a){return.5>a?0:1},oneStep:function(a){return a>=1?1:0},random:function(){return Math.random()},randomLimit:function(a){return Math.random()*a}},b=Math.pow,c=Math.PI;return function(b){t(b,function(b,c){var d=b;a[c+"In"]=d,a[c+"Out"]=function(a){return 1-d(1-a)},a[c+"InOut"]=function(a){return.5>a?d(2*a)/2:1-d(-2*a+2)/2}})}({back:function(a){return a*a*(3*a-2)},elastic:function(a){return 0===a||1===a?a:-b(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*c/15)},sine:function(a){return 1-Math.cos(a*c/2)},circ:function(a){return 1-Math.sqrt(1-a*a)},cubic:function(a){return a*a*a},expo:function(a){return 0==a?0:b(2,10*(a-1))},quad:function(a){return a*a},quart:function(a){return b(a,4)},quint:function(a){return b(a,5)},bounce:function(a){for(var c,d=4;a<((c=b(2,--d))-1)/11;);return 1/b(4,3-d)-7.5625*b((3*c-2)/22-a,2)}}),Object.freeze(a)}(),function(a){function b(a,b){return e.apply((b||document).querySelectorAll(a))}function c(a,b){return(b||document).querySelector(a)}function d(){var b=eb.readyFuncs;eb.global.init(),eb.readyFuncs=null,b.forEach(function(b){b(a)})}var e=Array.prototype.slice;a.$$=b,a.$=c,a.ele=W,"loading"!==document.readyState&&setTimeout(d,0),document.addEventListener("DOMContentLoaded",d)}(a);var Ib=Math.sin,Jb=Math.cos,Kb=Math.tan,Lb=function(){function a(a){return(+a).toFixed(5)}var b=[0,1,3,4,6,7];return function(c){return b.map(function(b){return a(c[b])})}}();a.Mat3=X,X.prototype={print:function(){for(var a=this.elements,b=[],c=0;3>c;c++){for(var d=0;3>d;d++)b.push(a[d+3*c].toFixed(2));b.push("\n")}return b.join(" ")},reset:function(a){return this.elements=new Float32Array(a),this},set:function(a,b,c){return this.elements[3*a+b]=c,this},concat:function(a){var b=a instanceof X?a.elements:a;return Z(this,b)},axonProject:function(a,b){a=a||0,b=b||0;var c=Jb(a),d=Ib(a),e=Jb(b),f=Ib(b);return Z(this,[e,d*f,0,0,c,0,f,-e*d,0],1)},obliqueProject:function(a,b){b=b||0,a=a||0;var c=1/Kb(a),d=Ib(b)*c,e=Jb(b)*c;return Z(this,[1,0,0,0,1,0,e,d,0],1)},toString:function(){return"matrix("+Lb(this.elements).join(",")+")"},applyContext2D:function(a){return a.transform.apply(a,Lb(this.elements)),this},clone:function(){return new X(this.elements)},scale:function(a,b){return Z(this,[Y(a,1),0,0,0,Y(b,1),0,0,0,1])},skew:function(a){return Z(this,[1,Kb(a),0,Kb(a||0),1,0,0,0,1])},transform:function(a,b,c,d,e,f){return Z(this,[a,c,0,b,d,0,e||0,f||0,1])},translate:function(a,b,c){return Z(this,[1,0,0,0,1,0,a||0,b||0,Y(c,1)])},flip:function(a,b,c){var d=Ib(a),e=Jb(a);return c=c||.6,Z(this,b?[1,0,0,-d*c,e,0,0,0,1]:[e,d*c,0,0,1,0,0,0,1])},rotate:function(a){return this.rotateZ(a)},rotateX:function(a){var b=Ib(a),c=Jb(a);return Z(this,[1,0,0,0,c,b,0,-b,c])},rotateY:function(a){var b=Ib(a),c=Jb(a);return Z(this,[c,0,-b,0,1,0,b,0,c])},rotateZ:function(a){var b=Ib(a),c=Jb(a);return Z(this,[c,b,0,-b,c,0,0,0,1])}},function(a){function b(a){n?a():setTimeout(a,0)}function c(a){return this instanceof c?(this.then=a.then,void(this.get=a.get)):new c(a)}function d(a){if(a instanceof H)return a.promise;if(a instanceof Array)return g.all(a.map(d));if(j(a))return a;if(!o)return m(a);throw Error("cannot cast to promise")}function e(a){return j(a)?a:new c({then:function(b){try{return e(d(i(b(a))))}catch(a){return f(a)}},get:function(b){return b?a[b]:a}})}function f(a){return j(a)?a:new c({then:function(b,c){try{return e(c(a))}catch(a){return f(a)}},get:function(b){
return b?a[b]:a}})}function g(a){function d(a){try{k(i(a))}catch(a){k(void 0,a)}}function j(a){k(void 0,a||new Error(""))}function k(a,c){if(!o){n=void 0==c?e(a):f(c),o=!0;for(var d=0,g=p.length;g>d;d++)b(function(a,b){return function(){var c=n.then.apply(n,a);b&&c.then.apply(c,b)}}(p[d],q[d]));p=q=void 0}}function l(a,b){q.push([a,b])}if(!(this instanceof g))return new g(a);var n,o,p=[],q=[];return"function"!=typeof a?i(a):(a(d,j),new c({then:function(a,b){var c=[h(a,function(a){return a}),h(b,function(a){throw a})];return n?m(n.then.apply(n,c)):(p.push(c),new g(function(a,b){l(a,b)}))},get:function(a){return n?n.get(a):void 0}}))}function h(a,b){var c;return"object"==(c=typeof a)?function(){return a}:"function"===c?a:b}function i(b){var c;if(o){if(b instanceof H)return b._finished?b:b.promise;if("object"==(c=typeof b))return j(b)?b:b instanceof Array?b.map(i):a.animate(b).promise;if("function"==typeof c)return i(b());throw Error("cannot cast to animation")}return b}function j(a){return a instanceof c}function k(a){return new g(function(b,c){function d(a,d,h){if(!h)try{g[d]=a instanceof H?a:i(a)}catch(a){h=a}h&&(e=!0,g[d]=h),1==f?e?c(g):b(g):f--}var e,f,g=new Array(f=a.length);return a.length?void a.forEach(function(a,b){a.then(function(a){d(a,b)},function(a){d(a,b,!0)})}):b(g)})}function l(a){return g(function(b,c){a.then(b,c)})}function m(a){return g(function(b){b(a)})}var n,o=!0;g.all=k,g.defer=function(){var a={};return a.promise=g(function(b,c){a.resolve=b,a.reject=c}),a},g.resolve=function(a){return a&&w(a.then)?l(a):m(a)},g.reject=function(a){return g(function(b,c){c(a)})},g.digest=l,g.option=function(a){a&&(o=!!a.acceptAnimationOnly,n=!!a.sync)},eb.Promise=a.Promise=g}(a),a.RenderGlobal=na,d(na,a.util.Object,{get defaultTask(){var a=this._defaultTaskName,b=this._tasks[a];return b||this.add(b=new G(a)),b},getTask:function(a,b){if(!a)return this.defaultTask;var c=this._tasks[a];return!c&&b&&(c=new G(a),this.add(c)),c},add:function(a){var b,c;if(a instanceof G){if(!(b=a.name))throw Error("task must has a name");if((c=this._tasks).hasOwnProperty(b))throw Error("contains same name task");if(c[b]=a)return a._global=this,a.timeline.start(),this.invalid()}else if(x(a))return this.defaultTask.add(a);return!1},immediate:function(){function a(){return b?(d.forEach(function(a){b.deleteRule(a),b.insertRule("*{}",a),c.push(a)}),!(b=null)):void 0}var b=this._persistElement.sheet,c=this._persistIndies,d=[],e=arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.apply(arguments);return e.forEach(function(a){var e;c.length?(e=c.pop(),b.deleteRule(e)):e=b.cssRules.length,b.insertRule(a,e),d.push(e)}),a},refresh:function(){this._foreceRender=!0},init:function(){if("object"==typeof window){var b=document.head;this._styleElement.parentNode||(b.appendChild(this._styleElement),b.appendChild(this._persistElement)),a.fallback(window),this.loop()}this.init=function(){console.warn("The settings have been initiated,do not init twice")}},invalid:function(){return this._invalid=!0},loop:function(a){$(this),window.requestAnimationFrame(this.loop.bind(this),a||window.document.body)},createRenderState:function(){return{global:this,task:null,styleStack:[],forceRender:this._foreceRender,transformMap:{}}},css:function(a,b){return oa(this,"css",a,b)},transform:function(a,b){return oa(this,"transform",a,b)}}),eb.global=new na,d(pa,a.util.Object,{ticksPerSecond:1e3,stop:function(){this._isStop||(this._isStop=!0,this._lastStop=Date.now())},start:function(){this._isStop&&(this._isStop=!1,this._stopTime+=Date.now()-this._lastStop)},move:function(){this._isStop||(this.last=this.now,this.now=Date.now()-this._startTime-this._stopTime)}});var Mb=function(){var a={};return function(b){return a.hasOwnProperty(b)||(a[b]=1),a[b]++}}();a.GL={Scene:Ma,Task:Ga,Vector:Ta,Render:qa,Geometry:Ba,Uniform:sa,Attribute:wa,Binder:ra,Sampler2D:Ha,SamplerCube:La,Buffer:ya,Matrix4:Ua,Camera:za,FrameBuffer:Aa,Texture:Sa,RenderBuffer:Fa},function(a){var b=a.prototype;for(var c in b)/^[A-Z0-9_]+$/.test(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c])}(window.WebGLRenderingContext),d(qa,F.prototype,{get disabled(){return this._disabled},get parent(){return this._parent},set disabled(a){this._disabled!=a&&(this._disabled=a,this.invalid())},findChild:function(a,b){var c;return this._children.some(function(d){return a(d)?c=d:b&&w(d.findChild)&&(c=d.findChild(a,b)),c}),c},update:function(a){this._disabled||(a.glRender=this,bb(this,a),this._children.forEach(function(b){b.update(a)}))},add:function(){for(var a=0,b=arguments[0];b;b=arguments[++a])b instanceof qa?f(this._children,b)&&(b._parent=this):this.addBinder(b);return this.invalid(),this},addBinder:function(a,b){return a&&(this._invalidBinder=!0,cb(this.binder,a,b)),this},render:function(a){this._disabled||(ab(this.binder,a),this._children.forEach(function(b){b.render(a)}))},dispose:function(a){db(this.binder,a),this._children.forEach(function(b){w(b.dispose)&&b.dispose(a)})}}),ra.prototype={bind:z,invalid:function(){var a=this._controller;a&&a.invalid(),this._invalid=!0},dispose:function(){this._controller=null}},d(sa,ra.prototype,{get value(){return this._val},set value(a){this.invalid(),this._val=a},bind:function(a,b){var c;this._invalid&&(c=b.glSecne.uniforms[this.name])&&(c.use(a,this._val),this._invalid=!1)}}),ta.prototype={use:function(a,b){Ob[this.type](a,b,this._loc)},convert:function(a){return Nb[this.type](this.name,a)}};var Nb=ta.converter={vec4:function(a,b){return new sa({name:a,value:ua(b,4)})},vec3:function(a,b){return new sa({name:a,value:ua(b,3)})},vec2:function(a,b){return new sa({name:a,value:ua(b,2)})},mat4:function(a,b){return new sa({name:a,value:va(b,16)})},mat3:function(a,b){return new sa({name:a,value:va(b,9)})},mat2:function(a,b){return new sa({name:a,value:va(b,4)})},float:function(a,b){return new sa({name:a,value:+b})},sampler2D:function(a,b){return new Ha({name:a,source:b})},samplerCube:function(a,b){throw Error("not implement")},int:function(a,b){return new sa({name:a,value:parseInt(b)})}},Ob=ta.setter={vec4:function(a,b,c){a.uniform4fv(c,b.elements)},vec3:function(a,b,c){a.uniform3fv(c,b.elements)},vec2:function(a,b,c){a.uniform2fv(c,b.elements)},mat4:function(a,b,c){a.uniformMatrix4fv(c,!1,b.elements)},mat3:function(a,b,c){a.uniformMatrix3fv(c,!1,b.elements)},mat2:function(a,b,c){a.uniformMatrix2fv(c,!1,b.elements)},float:function(a,b,c){a.uniform1f(c,b)},sampler2D:function(a,b,c){a.uniform1i(c,b)},samplerCube:function(a,b,c){a.uniform1i(c,b)},int:function(a,b,c){a.uniform1i(c,b)}};d(wa,ra.prototype,{set buffer(a){var b=this._buffer;if(b instanceof ya&&b.release(this),a instanceof ya)this._buffer=a;else{if(!(a&&a.buffer instanceof ArrayBuffer))throw Error("expect attribute data to be a TypedArray or GLBuffer");this._buffer=new ya(a)}this._buffer.ref(this)},get buffer(){return this._buffer},get data(){var a=this.buffer;return a?a.data:null},set data(a){if(a instanceof ya)this.buffer=a;else{if(!(a.buffer instanceof ArrayBuffer))throw Error();var b=this.buffer;b?(b.data=a,b.invalid()):this.buffer=new ya(a)}this.invalid()},bind:function(a,b){var c=b.glParam[this.name];this.buffer.bind(a),a.enableVertexAttribArray(c._loc),a.vertexAttribPointer(c._loc,c._size,a.FLOAT,!1,this._stride,this._offset)},invalid:function(){this.buffer.invalid()},dispose:function(a){this.buffer.release(this),this.buffer.finalize(a)}}),xa.prototype={convert:function(a){return new wa(this.name,a)}},ya.prototype={getGlHandle:function(a){return this._glHandle||(this._glHandle=a.createBuffer())},ref:function(a){f(this._refs,a)},release:function(a){i(this._refs,a)},invalid:function(){this._buffered=!1},finalize:function(a){if(0==this._refs.length){var b=this._glHandle;b&&a.deleteBuffer(b),this._data=null}},get data(){return this._data},set data(a){a&&a!==this._data&&(WebGLRenderingContext.ARRAY_BUFFER===this._type?this._data=a instanceof Float32Array?a:new Float32Array(a):this._data=a instanceof Int16Array?a:new Int16Array(a),this._buffered=!1,this.length=a.length)},bufferData:function(a){return this._buffered?!1:(a.bufferData(this._type,this._data,this.usage),this._buffered=!0,!0)},bind:function(a){var b=this.getGlHandle(a);a.bindBuffer(this._type,b),this._buffered||(a.bufferData(this._type,this._data,this.usage),this._buffered=!0)},dispose:function(a){this._glHandle&&(this._refs.length&&console.warn("the buffer is being used when disposed"),a.deleteBuffer(this._glHandle),this._glHandle=null)}},function(){function a(a){for(var b=a.elements,c=0,d=b.length;d>c;c++)if(isNaN(b[c]))return new Ua;return a}function b(a,b){var c="_"+b;Object.defineProperty(a,b,{get:function(){return this[c]},set:function(a){if(isNaN(a))throw Error("property "+b+" value should be number");a!=this[c]&&(this[c]=+a,this.resetMatrix(),this.invalid())}})}var c=["zNear","zFar","fovy","aspect","eyeX","eyeY","eyeZ","centerX","centerY","centerZ","upX","upY","upZ"];d(za,ra.prototype,{bind:function(a,b){if(this._invalid){var c=b.glSecne.uniforms[this.viewProjectionMatrixUniformName];if(c)c.use(a,this.viewProjectionMatrix),this._invalid=!1;else{var d=b.glSecne.uniforms[this.viewMatrixUniformName],e=b.glSecne.uniforms[this.projectionMatrixUniformName];d&&e&&(d.use(a,this.viewMatrix),e.use(a,this.projectionMatrix),this._invalid=!1)}}},get viewMatrix(){var b=this._viewMatrix;return b||(b=a(Ua.fromLookAt([this._eyeX,this._eyeY,this._eyeZ],[this._centerX,this._centerY,this._centerZ],[this._upX,this._upY,this._upZ])),this._viewMatrix=b,this._vpMatrix=null),b},get projectionMatrix(){var b=this._projectionMatrix;return b||(b=a(Ua.fromPerspective(this._fovy,this._aspect,this._zNear,this._zFar)),this._projectionMatrix=b,this._vpMatrix=null),b},get viewProjectionMatrix(){var a=this._vpMatrix;return a||(a=this._vpMatrix=this.projectionMatrix.concat(this.viewMatrix)),a},setPerspective:function(a,b,c,d){return this.fovy=a,this.aspect=b,this.zNear=c,this.zFar=d,this},setPosition:function(a,b,c){return a&&(this.eyeX=a[0],this.eyeY=a[1],this.eyeZ=a[2]),b&&(this.centerX=b[0],this.centerY=b[1],this.centerZ=b[2]),c&&(this.upX=c[0],this.upY=c[1],this.upZ=c[2]),this},resetMatrix:function(){this._projectionMatrix=null,this._viewMatrix=null,this._vpMatrix=null},config:function(a){var b=this;return t(a,function(a,d){c.indexOf(d)>-1&&(b[d]=a)}),b}}),c.forEach(function(a){b(za.prototype,a)})}(),d(Aa,ra.prototype,{get glObj(){return this._fbo},get depthBuffer(){return this._depthBuffer},get texture(){return this._texture},set texture(a){a!==this.texture&&(this._texture=a,this._buffered=!1)},dispose:function(a){var b=this.depthBuffer;b&&b.dispose(a),this.texture.dispose(a),this._fbo&&(a.deleteFramebuffer(this._fbo),this._fbo=null)},bindUniformEntry:function(a,b){var c=this.texture;c.bind(a),b.use(a,c._index)},bind:function(a){this.bufferData(a)||a.bindFramebuffer(a.FRAMEBUFFER,this._fbo)},unbind:function(a){a.bindFramebuffer(a.FRAMEBUFFER,null)},bindTexture:function(a,b){if(!(b instanceof Sa))throw Error("invalid texture");b.bind(a),a.bindFramebuffer(a.FRAMEBUFFER,this._fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b.glObj,0)},bindDepthBuffer:function(a,b,c,d){b instanceof Fa&&(b.bind(a),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c,d),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b.glObj))},bufferData:function(a){if(!this._buffered){var b=this._w||a.canvas.width,c=this._h||a.canvas.height;if(this._fbo||(this._fbo=a.createFramebuffer()),this.bindTexture(a,this._texture),t(this.textureParam,function(b,c){a.texParameteri(a.TEXTURE_2D,a[c],a[b])}),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.bindDepthBuffer(a,this._depthBuffer,b,c),a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("framebuffer fail");return this._buffered=!0,!0}return!1},set width(a){a=parseInt(a),a&&this._w!=a&&(this._w=a,this._buffered=!1)},set height(a){a=parseInt(a),a&&this._h!=a&&(this._h=a,this._buffered=!1)}}),d(Ba,qa.prototype,{set indexBuffer(a){this.releaseBuffer(),a instanceof ya||(a=new ya(a,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER)),this._indexBuffer=a,a.ref(this),this.draw=Ca},dispose:function(a){qa.prototype.dispose.apply(this,arguments);var b=this.releaseBuffer(a);b&&b.dispose(a)},update:function(a){qa.prototype.update.call(this,a),t(this.binder,function(a){a instanceof ra&&(a._invalid=!0)})},setDrawRange:function(a,b){this.releaseBuffer(),this.startIndex=b||0,this.drawCount=a,this.draw=Da},render:function(a){ab(this.binder,a),this.draw(a.gl,a)},releaseBuffer:function(){var a=this._indexBuffer;return a instanceof ya&&a.release(),a},draw:z}),Ea.prototype={increaseTextureIndex:function(){for(var a=this._indexUsage,b=0,c=a[0],d=0,e=a.length;e>b;b++)a[b]<c&&(d=b,c=a[b]);return a[d]++,d},releaseTextureIndex:function(a){return--this._indexUsage[a]}},Fa.prototype={get glObj(){return this._glObj},dispose:function(a){this._glObj&&(a.deleteRenderbuffer(this._glObj),this._glObj=null)},bind:function(a){var b=this.glObj;b||(this._glObj=b=a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,b)}},d(Ga,G,{init:function(a){var b,c=a.gl||(b=a.canvas).getContext("webgl")||b.getContext("experimental-webgl");this.gl=c,this.resMng=c.resMng||(c.resMng=new Ea(c))},update:function(a){a.gl=this.gl,a.glResMng=this.resMng},remove:function(a){var b=this._updateObjs,c=b.indexOf(a);c>-1&&(b[c]=null,f(this._finalizeObjs,a),this.invalid())}}),a.util.inherit(Ha,sa.prototype,{get textureIndex(){return this._texture._index},set source(a){Ka(this,a),this._buffered=!1},get value(){return this.source},get source(){return this._source},set value(a){this.source=a},set texture(a){a instanceof Sa&&a!=this._texture&&(this._texture=a,this._buffered=!1)},bind:function(a,b){var c=b.glParam[this.name];this.bufferData(a),c.use(a,this.textureIndex)},dispose:function(a){var b=this._texture;b&&(b.dispose(a),this._buffered=!1)},bufferData:function(a){if(!this._buffered){var b=this.source,c=this.param,d=this._texture,e=this.format;d.bind(a),b&&(a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,this.flipY),Ja(b)||Ia(b)?a.texImage2D(a.TEXTURE_2D,0,e,e,a.UNSIGNED_BYTE,b):a.texImage2D(a.TEXTURE_2D,0,e,b.width,b.height,0,e,a.UNSIGNED_BYTE,b.data),t(c,function(b,c){a.texParameteri(a.TEXTURE_2D,a[c],a[b])})),this._buffered=!0}}}),d(Ma,qa.prototype,{update:function(a){Na(this,a.gl),this.updateRenderState(a),qa.prototype.update.call(this,a)},dispose:function(a){qa.prototype.dispose.apply(this,arguments);var b=this.program;b&&(a.deleteProgram(this.program),this.program=null)},updateRenderState:function(a){a.glSecne=this,a.glParam=this.glParam},render:function(a){var b=this.program,c=a.gl;b&&c.useProgram(b),this.updateRenderState(a),ab(this.binder,a),this._children.forEach(function(b){b.render(a)})},buildBinder:function(a){return Qa(this._glVars,a)}}),Ma.buildBinder=function(a,b){return Qa(Ra(a),b)},Sa.prototype={get glObj(){return this._glHandle},dispose:function(a){var b=this._glHandle,c=a.resMng;c&&c.releaseTextureIndex(this._index),b&&(a.deleteTexture(b),this._glHandle=null)},getGlHandle:function(a){return this._glHandle||(this._glHandle=a.createTexture())},bind:function(a){var b=a.resMng,c=this._index;-1==c&&(this._index=c=b.increaseTextureIndex()),a.activeTexture(WebGLRenderingContext["TEXTURE"+c]),a.bindTexture(this._type,this.getGlHandle(a))}},Ta.prototype={clone:function(){return new Ta(this.elements)},get x(){return this.elements[0]},get y(){return this.elements[1]},get z(){return this.elements[2]},get w(){return this.elements[3]},set x(a){this.elements[0]=a},set y(a){this.elements[1]=a},set z(a){this.elements[2]=a},set w(a){this.elements[3]=a},get r(){return this.elements[0]},get g(){return this.elements[1]},get b(){return this.elements[2]},get a(){return this.elements[3]},set r(a){this.elements[0]=a},set g(a){this.elements[1]=a},set b(a){this.elements[2]=a},set a(a){this.elements[3]=a},get length(){return this.elements.length},add:function(a){for(var b=a instanceof Ta?a.elements:a,c=0,d=this.elements,e=this.elements.length;e>c;c++)d[c]+=b[c]||0}};var Pb=1e-6;Ua.prototype={clone:function(){return new Ua(this)},translate:function(a,b,c){return Za(this.elements,this.elements,[a,b,c]),this},scale:function(a,b,c){return Ya(this.elements,this.elements,[a,b,c]),this},rotate:function(a,b){return Xa(this.elements,this.elements,a,b),this},concat:function(a){return $a(this.elements,this.elements,a.elements),this},perspective:function(a,b,c,d){return $a(this.elements,this.elements,Wa(new Float32Array(16),a,b,c,d)),this},lookAt:function(a,b,c){return $a(this.elements,this.elements,Va(new Float32Array(16),a,b,c)),this},toString:function(a){var b=this.elements,c="";a=a||3;for(var d,e=0;4>e;e++)c+=b[d=4*e].toFixed(a)+"	"+b[d+1].toFixed(a)+"	"+b[d+2].toFixed(a)+"	"+b[d+3].toFixed(a)+"\n";return c},concatVec4:function(a,b,c,d){return _a([],[+a,+b,+c,isNaN(d)?1:+d],this.elements)}},Ua.fromPerspective=function(a,b,c,d){var e=new Float32Array(16);return Wa(e,a,b,c,d),new Ua(e)},Ua.fromLookAt=function(a,b,c){var d=new Float32Array(16);return Va(d,a,b,c),new Ua(d)},Ua.fromScale=function(a,b,c){var d=new Ua,e=d.elements;return Ya(e,e,[a,b,c]),d},Ua.fromTranslate=function(a,b,c){var d=new Ua,e=d.elements;return Za(e,e,[a,b,c]),d},Ua.fromConcat=function(a,b){var c=new Ua,d=c.elements;return $a(d,a.elements,b.elements),c},Ua.fromRotate=function(a,b){var c=new Ua,d=c.elements;return Xa(d,d,a,b),c}}();